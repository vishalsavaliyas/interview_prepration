<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>React Machine Coding Interview</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- React CDN -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      padding: 20px;
    }
    h1, h2 {
      color: #2c3e50;
    }
    .card {
      background: #fff;
      padding: 20px;
      margin-bottom: 25px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    button {
      margin: 5px;
      padding: 6px 12px;
      cursor: pointer;
    }
    .item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">

/* =========================
   MACHINE CODING 1: CART
========================= */

function CartApp() {
  const [cart, setCart] = React.useState([]);

  const addToCart = (product) => {
    setCart(prev => {
      const existing = prev.find(item => item.id === product.id);
      if (existing) {
        return prev.map(item =>
          item.id === product.id
            ? { ...item, qty: item.qty + 1 }
            : item
        );
      }
      return [...prev, { ...product, qty: 1 }];
    });
  };

  const removeFromCart = (id) => {
    setCart(prev =>
      prev
        .map(item =>
          item.id === id ? { ...item, qty: item.qty - 1 } : item
        )
        .filter(item => item.qty > 0)
    );
  };

  const total = cart.reduce((sum, item) => sum + item.price * item.qty, 0);

  return (
    <div className="card">
      <h2>üõí Shopping Cart</h2>

      <button onClick={() => addToCart({ id: 1, name: "Phone", price: 20000 })}>
        Add Phone
      </button>
      <button onClick={() => addToCart({ id: 2, name: "Laptop", price: 50000 })}>
        Add Laptop
      </button>

      <h3>Cart Items</h3>
      {cart.map(item => (
        <div className="item" key={item.id}>
          <span>{item.name} x {item.qty}</span>
          <button onClick={() => removeFromCart(item.id)}>Remove</button>
        </div>
      ))}

      <h3>Total: ‚Çπ{total}</h3>
    </div>
  );
}

/* =========================
   MACHINE CODING 2: INFINITE SCROLL
========================= */

function InfiniteScroll() {
  const [items, setItems] = React.useState([]);
  const [page, setPage] = React.useState(1);
  const [loading, setLoading] = React.useState(false);

  const loadData = async () => {
    if (loading) return;
    setLoading(true);

    const res = await fetch(
      `https://jsonplaceholder.typicode.com/posts?_limit=10&_page=${page}`
    );
    const data = await res.json();

    setItems(prev => [...prev, ...data]);
    setPage(prev => prev + 1);
    setLoading(false);
  };

  React.useEffect(() => {
    loadData();
  }, []);

  React.useEffect(() => {
    const onScroll = () => {
      if (
        window.innerHeight + window.scrollY >=
        document.body.offsetHeight - 100
      ) {
        loadData();
      }
    };

    window.addEventListener("scroll", onScroll);
    return () => window.removeEventListener("scroll", onScroll);
  }, [page, loading]);

  return (
    <div className="card">
      <h2>‚ôæÔ∏è Infinite Scroll</h2>
      {items.map(item => (
        <p key={item.id}>{item.title}</p>
      ))}
      {loading && <p>Loading...</p>}
    </div>
  );
}

/* =========================
   MACHINE CODING 3: AUTH FLOW
========================= */

function AuthApp() {
  const [isAuth, setIsAuth] = React.useState(
    !!localStorage.getItem("token")
  );

  const login = () => {
    localStorage.setItem("token", "fake-jwt-token");
    setIsAuth(true);
  };

  const logout = () => {
    localStorage.removeItem("token");
    setIsAuth(false);
  };

  return (
    <div className="card">
      <h2>üîê Authentication Flow</h2>

      {isAuth ? (
        <>
          <p>Welcome to Dashboard</p>
          <button onClick={logout}>Logout</button>
        </>
      ) : (
        <>
          <p>Please Login</p>
          <button onClick={login}>Login</button>
        </>
      )}
    </div>
  );
}

/* =========================
   ROOT APP
========================= */

function App() {
  return (
    <>
      <h1>React Machine Coding ‚Äì Practical Interview</h1>
      <CartApp />
      <InfiniteScroll />
      <AuthApp />
    </>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);

</script>
</body>
</html>
